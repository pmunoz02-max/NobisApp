<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Nobis App Multiusuario</title>
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  <script>
    // Inicializar EmailJS con tu Public Key
    (function(){
      emailjs.init("qSmyIiQYgJVnpllqS");  // üëà tu Public Key
    })();

    // IDs de EmailJS (aj√∫stalos a tu cuenta real)
    const SERVICE_ID = "service_fuhd91q";   // üëà tu Service ID
    const TEMPLATE_ID = "template_k4gnktv"; // üëà tu Template ID

    // Lista simulada de administradores
    let admins = ["pmunoz02@gmail.com"];

    function login() {
      const email = document.getElementById("loginEmail").value;
      if (admins.includes(email)) {
        alert("‚úÖ Acceso concedido: " + email);
        document.getElementById("nivel").innerText = "Due√±o/Admin";
      } else {
        alert("‚ùå Acceso denegado. El email no es administrador.");
        document.getElementById("nivel").innerText = "Invitado";
      }
    }

    function crearAdmin() {
      const nuevoAdmin = document.getElementById("nuevoAdminEmail").value;
      if (!nuevoAdmin) {
        alert("Por favor, ingrese un correo v√°lido.");
        return;
      }

      // Token para activar
      const token = Math.random().toString(36).substring(2,10);
      const activationLink = `https://pmunoz02-max.github.io/NobisApp/?activate=${nuevoAdmin}&token=${token}`;

      const templateParams = {
        to_email: nuevoAdmin,
        message: `Has sido invitado como administrador. Activa aqu√≠: ${activationLink}`
      };

      // Enviar con EmailJS
      emailjs.send(SERVICE_ID, TEMPLATE_ID, templateParams)
        .then((response) => {
          alert("‚úÖ Invitaci√≥n enviada correctamente a " + nuevoAdmin);
          admins.push(nuevoAdmin); // lo agregamos como admin
          mostrarAdmins();
        }, (error) => {
          console.error("EmailJS error:", error);
          alert("‚ùå Error al enviar invitaci√≥n. Revisa configuraci√≥n.");
        });
    }

    function enviarPrueba() {
      const templateParams = {
        to_email: "pmunoz02@gmail.com",
        message: "üì© Este es un correo de prueba desde NobisApp."
      };

      emailjs.send(SERVICE_ID, TEMPLATE_ID, templateParams)
        .then((response) => {
          alert("‚úÖ Correo de prueba enviado correctamente.");
        }, (error) => {
          console.error("EmailJS prueba error:", error);
          alert("‚ùå Error al enviar correo de prueba.");
        });
    }

    function mostrarAdmins() {
      const lista = document.getElementById("listaAdmins");
      lista.innerHTML = "";
      admins.forEach(a => {
        const li = document.createElement("li");
        li.textContent = a;
        lista.appendChild(li);
      });
    }

    window.onload = mostrarAdmins;
  </script>
</head>
<body>
  <h2>Administraci√≥n</h2>

  <div>
    <label>Email de login:</label>
    <input type="email" id="loginEmail" value="fenice.ecuador@gmail.com"/>
    <button onclick="login()">Ingresar</button>
  </div>

  <p><b>Nivel actual:</b> <span id="nivel">Invitado</span></p>

  <h3>Crear nuevo Administrador</h3>
  <input type="email" id="nuevoAdminEmail" placeholder="nuevoadmin@dominio.com"/>
  <button onclick="crearAdmin()">Crear Admin</button>

  <h3>Prueba de Correo</h3>
  <button onclick="enviarPrueba()">Enviar correo de prueba</button>

  <h3>Administradores activos</h3>
  <ul id="listaAdmins"></ul>
</body>
</html>
