<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Nobis App - Administración</title>
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@2.6.4/dist/email.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h2, h3 { color: #2c3e50; }
    input { margin: 5px; padding: 5px; }
    button { margin: 5px; padding: 6px 12px; cursor: pointer; }
    ul { list-style: none; padding: 0; }
    li { margin: 4px 0; }
  </style>
</head>
<body>
  <h2>Administración</h2>

  <div>
    <label>Email de login:</label>
    <input type="email" id="loginEmail" placeholder="tuemail@dominio.com">
    <button onclick="login()">Ingresar</button>
  </div>

  <h3>Crear nuevo Administrador</h3>
  <input type="email" id="newAdminEmail" placeholder="nuevoadmin@dominio.com">
  <button onclick="crearAdmin()">Crear Admin</button>

  <h3>Prueba de Correo</h3>
  <button onclick="enviarCorreoPrueba()">Enviar correo de prueba</button>

  <h3>Administradores activos</h3>
  <ul id="adminsActivos"></ul>

  <script>
    // Inicializar EmailJS con tu Public Key
    (function(){
      emailjs.init("qSmyIiQYgJVnpllqS"); // <-- tu PUBLIC_KEY
    })();

    const SERVICE_ID = "service_fuhd91q";   // <-- tu Service ID
    const TEMPLATE_ID = "template_k4gnktv"; // <-- tu Template ID

    // ---------------------------
    // Al cargar la página
    // ---------------------------
    window.onload = function() {
      const params = new URLSearchParams(window.location.search);
      if (params.has("activate") && params.has("token")) {
        const email = params.get("activate");
        const token = params.get("token");

        let admins = JSON.parse(localStorage.getItem("admins")) || [];
        if (!admins.includes(email)) {
          admins.push(email);
          localStorage.setItem("admins", JSON.stringify(admins));
          alert("✅ " + email + " ha sido activado como Administrador");
        }
      }
      mostrarAdmins();
    };

    // Mostrar admins en la lista
    function mostrarAdmins() {
      const admins = JSON.parse(localStorage.getItem("admins")) || [];
      const lista = document.getElementById("adminsActivos");
      lista.innerHTML = admins.length
        ? admins.map(a => `<li>${a}</li>`).join("")
        : "<li>No hay administradores activos</li>";
    }

    // ---------------------------
    // Login de administrador
    // ---------------------------
    function login() {
      const email = document.getElementById("loginEmail").value;
      const admins = JSON.parse(localStorage.getItem("admins")) || [];

      if (admins.includes(email)) {
        alert("✅ Bienvenido administrador: " + email);
      } else {
        alert("❌ Acceso denegado, no eres administrador");
      }
    }

    // ---------------------------
    // Crear nuevo administrador
    // ---------------------------
    function crearAdmin() {
      const email = document.getElementById("newAdminEmail").value;
      if (!email) {
        alert("Por favor, ingresa un email válido.");
        return;
      }

      const token = Math.random().toString(36).substring(2, 10);
      const activationLink = `${window.location.origin}${window.location.pathname}?activate=${encodeURIComponent(email)}&token=${token}`;

      const templateParams = {
        to_email: email,
        message: "Has sido invitado como Administrador en Nobis App. Haz clic en el siguiente enlace para activar tu cuenta:",
        activation_link: activationLink
      };

      emailjs.send(SERVICE_ID, TEMPLATE_ID, templateParams)
        .then(() => {
          alert("✅ Invitación enviada a: " + email);
        })
        .catch(err => {
          console.error("EmailJS error:", err);
          alert("❌ Error al enviar invitación. Revisa la consola.");
        });
    }

    // ---------------------------
    // Enviar correo de prueba
    // ---------------------------
    function enviarCorreoPrueba() {
      const templateParams = {
        to_email: "fenice.ecuador@gmail.com",
        message: "Este es un correo de prueba desde Nobis App"
      };

      emailjs.send(SERVICE_ID, TEMPLATE_ID, templateParams)
        .then(() => {
          alert("✅ Correo de prueba enviado");
        })
        .catch(err => {
          console.error("EmailJS prueba error:", err);
          alert("❌ Error en correo de prueba. Revisa la consola (F12).");
        });
    }
  </script>
</body>
</html>
