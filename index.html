<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Nobis App - Administraci√≥n</title>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h2 { margin-top: 30px; }
    input, button { margin: 5px 0; padding: 5px; }
    button { cursor: pointer; }
  </style>
</head>
<body>
  <h1>Administraci√≥n</h1>

  <!-- Login -->
  <div>
    <label>Email de login:</label>
    <input type="email" id="loginEmail" placeholder="tuemail@dominio.com">
    <button onclick="login()">Ingresar</button>
  </div>

  <p><b>Nivel actual:</b> <span id="nivelActual">Invitado</span></p>

  <!-- Crear admin -->
  <h2>Crear nuevo Administrador</h2>
  <input type="email" id="nuevoAdminEmail" placeholder="nuevoadmin@dominio.com">
  <button onclick="crearAdmin()">Crear Admin</button>

  <!-- Prueba de correo -->
  <h2>Prueba de Correo</h2>
  <button onclick="enviarCorreoPrueba()">Enviar correo de prueba</button>

  <!-- Lista admins -->
  <h2>Administradores activos</h2>
  <ul id="listaAdmins">
    <li>pmunoz02@gmail.com</li>
  </ul>

  <script>
    // Inicializar EmailJS
    (function(){
      emailjs.init({
        publicKey: "qSmyIiQYgJVnpllgS" // üëà tu Public Key
      });
    })();

    // IDs de EmailJS
    const SERVICE_ID = "service_fuhd91q";
    const TEMPLATE_ID = "template_k4gnktv";

    // Lista admins en memoria
    let admins = ["pmunoz02@gmail.com"];
    let usuarioActivo = null;

    function login() {
      const email = document.getElementById("loginEmail").value.trim();
      if (admins.includes(email)) {
        usuarioActivo = email;
        document.getElementById("nivelActual").innerText = "Due√±o/Admin";
        alert("Bienvenido " + email);
      } else {
        document.getElementById("nivelActual").innerText = "Invitado";
        alert("Acceso denegado. El email no es administrador.");
      }
    }

    function crearAdmin() {
      if (!usuarioActivo) {
        alert("Debes iniciar sesi√≥n como administrador.");
        return;
      }

      const nuevoEmail = document.getElementById("nuevoAdminEmail").value.trim();
      if (!nuevoEmail) {
        alert("Por favor ingresa un correo v√°lido.");
        return;
      }

      // Par√°metros para la plantilla
      const params = {
        to_email: nuevoEmail,
        message: "Has sido invitado como administrador en Nobis App."
      };

      emailjs.send(SERVICE_ID, TEMPLATE_ID, params)
        .then(() => {
          admins.push(nuevoEmail);
          actualizarListaAdmins();
          alert("‚úÖ Invitaci√≥n enviada a " + nuevoEmail);
        })
        .catch((error) => {
          console.error("EmailJS error:", error);
          alert("‚ùå Error al enviar invitaci√≥n. Revisa la consola.");
        });
    }

    function enviarCorreoPrueba() {
      if (!usuarioActivo) {
        alert("Debes iniciar sesi√≥n para enviar un correo de prueba.");
        return;
      }

      const params = {
        to_email: usuarioActivo,
        message: "Este es un correo de prueba desde Nobis App ‚úÖ"
      };

      emailjs.send(SERVICE_ID, TEMPLATE_ID, params)
        .then(() => {
          alert("üìß Correo de prueba enviado a " + usuarioActivo);
        })
        .catch((error) => {
          console.error("EmailJS error:", error);
          alert("‚ùå Error en correo de prueba. Revisa la consola.");
        });
    }

    function actualizarListaAdmins() {
      const ul = document.getElementById("listaAdmins");
      ul.innerHTML = "";
      admins.forEach(admin => {
        const li = document.createElement("li");
        li.textContent = admin;
        ul.appendChild(li);
      });
    }
  </script>
</body>
</html>
