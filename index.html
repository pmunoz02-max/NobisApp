<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Nobis App - Test</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    body { margin:0; font-family: system-ui, Arial, sans-serif; }
    .app { display:grid; grid-template-columns:320px 1fr; height:100vh; }
    .sidebar { background:#f9fafb; border-right:1px solid #ddd; padding:8px; overflow-y:auto; }
    .sidebar h3 { margin-top:16px; margin-bottom:6px; font-size:14px; color:#111; }
    button { margin:2px 0; padding:4px 6px; border:1px solid #ccc; border-radius:4px; background:#fff; cursor:pointer; font-size:12px; }
    #map { width:100%; height:300px; }
    #coords { font-size:12px; color:#333; padding:4px; }
    .module { padding:10px; border-bottom:1px solid #ccc; }
  </style>
</head>
<body>
  <div class="app">
    <div class="sidebar">
      <h3>Módulos (prueba)</h3>
      <p>Aquí deberían aparecer todos a la vez.</p>
    </div>

    <div style="overflow-y:auto">
      <!-- Geocercas -->
      <div id="module-geocercas" class="module">
        <h2>Geocercas</h2>
        <div id="map"></div>
        <div id="coords">Lat: -, Lng: -</div>
        <button id="coordBtn">Nueva geocerca (Lat/Lng)</button>
        <ul id="fenceList"></ul>
      </div>

      <!-- Personal -->
      <div id="module-personal" class="module">
        <h2>Gestión de Personal</h2>
        <p>Geocerca activa: <span id="personal-geocerca">Ninguna</span></p>
        <button onclick="addPersonal()">Agregar Personal</button>
        <ul id="personal-list"></ul>
      </div>

      <!-- Actividades -->
      <div id="module-actividades" class="module">
        <h2>Gestión de Actividades</h2>
        <p>Geocerca activa: <span id="actividades-geocerca">Ninguna</span></p>
        <button onclick="addActividad()">Agregar Actividad</button>
        <ul id="actividades-list"></ul>
      </div>

      <!-- Costos -->
      <div id="module-costos" class="module">
        <h2>Costos</h2>
        <p>Geocerca activa: <span id="costos-geocerca">Ninguna</span></p>
        <button onclick="addCosto()">Agregar Costo</button>
        <ul id="costos-list"></ul>
      </div>

      <!-- Reportes -->
      <div id="module-reportes" class="module">
        <h2>Reportes</h2>
        <p>Geocerca activa: <span id="reportes-geocerca">Ninguna</span></p>
        <button onclick="generarReporte()">Generar Reporte</button>
        <div id="report-output"></div>
      </div>
    </div>
  </div>

<script>
let fences=[]; let activeId=null;
let db={ geocercas:[], personal:{}, actividades:{}, costos:{} };

function initMap(){
  let map=L.map('map').setView([-1.73,-77.91],14);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
    attribution:'&copy; OpenStreetMap'
  }).addTo(map);
}

function addPersonal(){
  if(!activeId){alert("Selecciona geocerca");return;}
  let nombre=prompt("Nombre:"); if(!nombre) return;
  if(!db.personal[activeId]) db.personal[activeId]=[];
  db.personal[activeId].push({nombre});
  renderData();
}
function addActividad(){
  if(!activeId){alert("Selecciona geocerca");return;}
  let act=prompt("Actividad:"); if(!act) return;
  if(!db.actividades[activeId]) db.actividades[activeId]=[];
  db.actividades[activeId].push({actividad:act});
  renderData();
}
function addCosto(){
  if(!activeId){alert("Selecciona geocerca");return;}
  let concepto=prompt("Concepto:"); let valor=parseFloat(prompt("Valor:"));
  if(isNaN(valor)) return;
  if(!db.costos[activeId]) db.costos[activeId]=[];
  db.costos[activeId].push({concepto,valor});
  renderData();
}
function generarReporte(){
  if(!activeId){alert("Selecciona geocerca");return;}
  let per=db.personal[activeId]||[];
  let act=db.actividades[activeId]||[];
  let cos=db.costos[activeId]||[];
  document.getElementById("report-output").innerHTML=
    `<p>Personal: ${per.length}</p>
     <p>Actividades: ${act.length}</p>
     <p>Costos: ${cos.length}, Total: $${cos.reduce((a,c)=>a+c.valor,0)}</p>`;
}
function renderData(){
  document.getElementById("personal-list").innerHTML=(db.personal[activeId]||[]).map(p=>`<li>${p.nombre}</li>`).join("");
  document.getElementById("actividades-list").innerHTML=(db.actividades[activeId]||[]).map(a=>`<li>${a.actividad}</li>`).join("");
  document.getElementById("costos-list").innerHTML=(db.costos[activeId]||[]).map(c=>`<li>${c.concepto}: $${c.valor}</li>`).join("");
}

initMap();
</script>
</body>
</html>
