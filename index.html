<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Nobis App Multiusuario</title>
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
    <script>
        (function(){
            // Inicializar EmailJS con tu PUBLIC KEY
            emailjs.init("qSmyIiQYgJVnpllqS");
        })();
    </script>
</head>
<body>
    <h2>Administraci√≥n</h2>

    <div>
        <label>Email de login:</label>
        <input type="email" id="loginEmail" placeholder="tucorreo@dominio.com">
        <button onclick="login()">Ingresar</button>
    </div>

    <p><b>Nivel actual:</b> Due√±o</p>

    <div>
        <h3>Crear nuevo Administrador</h3>
        <input type="email" id="newAdminEmail" placeholder="nuevoadmin@dominio.com">
        <button onclick="crearAdmin()">Crear Admin</button>
    </div>

    <div>
        <h3>Prueba de Correo</h3>
        <button onclick="correoPrueba()">Enviar correo de prueba</button>
    </div>

    <div>
        <h3>Administradores activos</h3>
        <ul id="adminList">
            <li>pmunoz02@gmail.com</li>
        </ul>
    </div>

    <p>[Aqu√≠ va el mapa con geocercas y m√≥dulos de tu app]</p>

    <script>
        // Funci√≥n de login (placeholder)
        function login() {
            const email = document.getElementById("loginEmail").value;
            alert("Funcionalidad de login a√∫n en desarrollo. Usuario: " + email);
        }

        // Crear un nuevo administrador y enviar invitaci√≥n
        function crearAdmin() {
            const adminEmail = document.getElementById("newAdminEmail").value;
            if (!adminEmail) {
                alert("Por favor ingresa un correo v√°lido.");
                return;
            }

            const token = Math.random().toString(36).substr(2, 8);
            const activationLink = `https://pmunoz02-max.github.io/NobisApp/?activate=${encodeURIComponent(adminEmail)}&token=${token}`;

            console.log("DEBUG ‚Üí Creando admin:", adminEmail);
            console.log("DEBUG ‚Üí Token generado:", token);
            console.log("DEBUG ‚Üí Activation link:", activationLink);

            // Enviar correo con EmailJS
            emailjs.send("service_fuhd91q", "template_k4gnktv", {
                to_email: adminEmail,
                from_name: "Nobis App",
                message: `Has sido invitado como Administrador en Nobis App.
                          Activa tu cuenta aqu√≠: ${activationLink}`
            })
            .then(function(response) {
                alert("‚úÖ Invitaci√≥n enviada a " + adminEmail);
                document.getElementById("adminList").innerHTML += `<li>${adminEmail}</li>`;
            }, function(error) {
                console.error("EmailJS error:", error);
                alert("‚ùå Error al enviar invitaci√≥n. Revisa la consola.");
            });
        }

        // Enviar correo de prueba
        function correoPrueba() {
            emailjs.send("service_fuhd91q", "template_k4gnktv", {
                to_email: "pmunoz02@gmail.com",
                from_name: "Nobis App",
                message: "Este es un correo de prueba desde Nobis App üöÄ"
            })
            .then(function(response) {
                alert("‚úÖ Correo de prueba enviado correctamente.");
            }, function(error) {
                console.error("EmailJS prueba error:", error);
                alert("‚ùå Error en correo de prueba. Revisa la consola.");
            });
        }
    </script>
</body>
</html>
