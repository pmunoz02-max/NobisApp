<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Nobis App - Administración</title>
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script>
    // Inicializar EmailJS con tu Public Key
    (function() {
      emailjs.init("qSmyIiQYgJVnpllgS"); 
      console.log("DEBUG → EmailJS inicializado con PUBLIC_KEY: qSmyIiQYgJVnpllgS");
    })();

    // Función para crear admin
    function crearAdmin() {
      const adminEmail = document.getElementById("ownerEmail").value;
      console.log("DEBUG → Creando admin:", adminEmail);

      const token = Math.random().toString(36).substr(2, 8);
      console.log("DEBUG → Token generado:", token);

      const activationLink = `https://pmunoz02-max.github.io/NobisApp/?activate=${encodeURIComponent(adminEmail)}&token=${token}`;
      console.log("DEBUG → Activation link:", activationLink);

      const templateParams = {
        to_email: adminEmail,
        activation_link: activationLink
      };

      emailjs.send("service_fuhd91q", "template_k4gnktv", templateParams)
        .then(function(response) {
          alert("✅ Invitación enviada correctamente a " + adminEmail);
          console.log("DEBUG → EmailJS success:", response);
        }, function(error) {
          alert("❌ Error al enviar correo: " + JSON.stringify(error));
          console.error("DEBUG → EmailJS error:", error);
        });
    }

    // Función de prueba
    function enviarPrueba() {
      const testParams = {
        to_email: "fenice.ecuador@gmail.com",
        activation_link: "https://pmunoz02-max.github.io/NobisApp/test"
      };

      emailjs.send("service_fuhd91q", "template_k4gnktv", testParams)
        .then(function(response) {
          alert("✅ Correo de prueba enviado correctamente");
          console.log("DEBUG → EmailJS prueba success:", response);
        }, function(error) {
          alert("❌ Error en correo de prueba: " + JSON.stringify(error));
          console.error("DEBUG → EmailJS prueba error:", error);
        });
    }
  </script>
</head>
<body>
  <h2>Administración</h2>
  <label>Email de login:</label>
  <input type="email" id="loginEmail" placeholder="tuemail@dominio.com">
  <button onclick="enviarPrueba()">Enviar Correo de Prueba</button>

  <h3>Nivel actual: <b>Dueño</b></h3>
  <label>Dueño:</label>
  <input type="email" id="ownerEmail" value="pmunoz02@gmail.com">
  <button onclick="crearAdmin()">Crear Admin</button>

  <h4>Administradores activos</h4>
  <ul id="adminList">
    <li>pmunoz02@gmail.com</li>
  </ul>
</body>
</html>
